<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDA Quiz</title>
    <link rel="icon" type="image/png" href="https://imgur.com/TcLgqbJ.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #ffffff;
            min-height: 100vh;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.05);
        }

        .header {
            background: #fff;
            border-bottom: 1px solid #e1e4e8;
            padding: 24px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content h1 {
            font-size: 1.6em;
            font-weight: 600;
            color: #24292e;
            margin-bottom: 6px;
        }

        .header-content p {
            color: #586069;
            font-size: 0.95em;
        }

        .aperture-header-logo {
            width: 100px;
            height: auto;
            opacity: 0.6;
            transition: all 0.3s ease;
        }
        

        .aperture-header-logo img {
            width: 100%;
            height: auto;
        }

        .progress-bar {
            height: 4px;
            background: #e1e4e8;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6700, #0098FF);
            transition: width 0.3s ease;
            width: 0%;
        }

        .content {
            padding: 40px;
            background: #fafbfc;
        }

        /* Menu principal */
        .menu {
            display: none;
        }

        .menu.active {
            display: block;
        }

        .menu h2 {
            font-size: 1.5em;
            font-weight: 600;
            color: #24292e;
            margin-bottom: 30px;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .module-card {
            background: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .module-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--module-color);
            transform: scaleY(0);
            transition: transform 0.2s ease;
        }

        .module-card:hover {
            border-color: var(--module-color);
            box-shadow: 0 3px 12px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }

        .module-card:hover::before {
            transform: scaleY(1);
        }

        .module-card.all { --module-color: #6f42c1; }
        .module-card.python { --module-color: #3572A5; }
        .module-card.git { --module-color: #F14E32; }
        .module-card.recursivite { --module-color: #00ADD8; }
        .module-card.debogage { --module-color: #CC6699; }
        .module-card.memoire { --module-color: #F1C40F; }
        .module-card.tests { --module-color: #27AE60; }
        .module-card.poo { --module-color: #E67E22; }
        .module-card.documentation { --module-color: #95A5A6; }
        .module-card.uml { --module-color: #3498DB; }
        .module-card.unity { --module-color: #000000; }

        .module-card h3 {
            font-size: 1.15em;
            font-weight: 600;
            color: #24292e;
            margin-bottom: 10px;
        }

        .module-card p {
            color: #586069;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .module-card .question-count {
            margin-top: 12px;
            color: #959da5;
            font-size: 0.85em;
            font-weight: 500;
        }

        /* Question */
        .question-container {
            display: none;
        }

        .question-container.active {
            display: block;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e1e4e8;
        }

        .question-number {
            background: #f6f8fa;
            color: #24292e;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            border: 1px solid #e1e4e8;
        }

        .module-tag {
            background: #fff;
            border: 1px solid #e1e4e8;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 0.85em;
            color: #586069;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .question-text {
            font-size: 1.25em;
            color: #24292e;
            margin-bottom: 35px;
            line-height: 1.6;
            font-weight: 500;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: #f6f8fa;
            border: 2px solid #e1e4e8;
            border-radius: 6px;
            padding: 18px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .option:hover {
            background: #fff;
            border-color: #0366d6;
            box-shadow: 0 2px 8px rgba(3,102,214,0.1);
        }

        .option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #0366d6;
        }

        .option span {
            color: #24292e;
            font-size: 0.98em;
            line-height: 1.5;
        }

        .option.correct {
            background: #dcffe4;
            border-color: #28a745;
        }

        .option.incorrect {
            background: #ffdce0;
            border-color: #d73a49;
        }

        .option.disabled {
            pointer-events: none;
            opacity: 0.8;
        }

        .explanation {
            display: none;
            background: #f1f8ff;
            border: 1px solid #c8e1ff;
            border-left: 4px solid #0366d6;
            padding: 18px 20px;
            margin-top: 25px;
            border-radius: 6px;
        }

        .explanation.show {
            display: block;
        }

        .explanation h4 {
            color: #0366d6;
            margin-bottom: 10px;
            font-size: 0.9em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .explanation p {
            color: #24292e;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .buttons {
            display: flex;
            gap: 12px;
            margin-top: 40px;
            justify-content: space-between;
        }

        button {
            padding: 10px 24px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            background: #fafbfc;
            color: #24292e;
        }

        button:hover:not(:disabled) {
            background: #f3f4f6;
            border-color: #d1d5da;
        }

        .btn-primary {
            background: #0366d6;
            color: white;
            border-color: #0366d6;
        }

        .btn-primary:hover:not(:disabled) {
            background: #0256c7;
            border-color: #0256c7;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Résultats */
        .results {
            display: none;
        }

        .results.show {
            display: block;
        }

        .results h2 {
            color: #24292e;
            font-weight: 600;
            font-size: 1.8em;
            margin-bottom: 30px;
        }

        .score-display {
            text-align: center;
            margin: 40px 0;
            padding: 30px;
            background: #f6f8fa;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
        }

        .score-display .score {
            font-size: 4em;
            font-weight: 300;
            color: #24292e;
            margin-bottom: 10px;
        }

        .score-display .total {
            font-size: 1.2em;
            color: #586069;
        }

        .module-stats {
            margin: 30px 0;
        }

        .module-stats h3 {
            margin-bottom: 15px;
            font-weight: 600;
            color: #24292e;
            font-size: 1.1em;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 18px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            margin-bottom: 10px;
            background: #fff;
        }

        .stat-item .module-name {
            font-weight: 600;
            color: #24292e;
        }

        .stat-item .module-score {
            color: #586069;
            font-weight: 600;
        }

        .stat-item .module-score.good {
            color: #28a745;
        }

        .stat-item .module-score.medium {
            color: #ffa500;
        }

        .stat-item .module-score.bad {
            color: #d73a49;
        }
        
        .footer {
            padding: 20px;
            margin: 0 auto;
            font-size: 12px;
            text-align: center;
            color: #586069;
        }
        
        .footer p:last-child {
            font-size: 10px;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }
        
        .footer p:last-child:hover {
            opacity: 0.7;
        }
        
        /* Portal Cake Easter Egg */
        .portal-cake {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: auto;
            opacity: 0.35;
            transition: opacity 0.3s ease;
            animation: float 3s ease-in-out infinite;
        }

        .portal-cake:hover {
            opacity: 0.7;
        }

        .portal-cake img {
            width: 100%;
            height: auto;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .header {
                padding: 20px;
            }

            .module-grid {
                grid-template-columns: 1fr;
            }

            .question-text {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>Test d'Aptitude Développeur</h1>
                <p>Protocole d'évaluation des compétences</p>
            </div>
            <div class="aperture-header-logo" id="apertureLogo" style="cursor: pointer;">
                <img src="https://i.imgur.com/7FQrTbz.png" alt="The cake is a lie">
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="content">
            <!-- Menu principal -->
            <div class="menu active" id="menu">
                <h2>Sélectionnez un module</h2>

                <div class="module-grid" id="moduleGrid"></div>
            </div>

            <!-- Questions -->
            <div id="quizContent"></div>

            <!-- Résultats -->
            <div class="results" id="results">
                <h2>Résultats</h2>
                
                <div class="score-display">
                    <div class="score" id="finalScore">0</div>
                    <div class="total"><span id="totalQuestions">0</span> questions</div>
                </div>

                <div class="score-time" id="scoreTime"></div>

                <div id="nameInputSection" class="name-input" style="display: none;">
                    <input type="text" id="playerName" placeholder="Entrez votre pseudo pour le classement" maxlength="20">
                    <button class="btn-primary" onclick="saveScore()" style="margin-top: 10px; width: 100%;">Enregistrer le score</button>
                </div>

                <div class="module-stats" id="moduleStats"></div>

                <div class="leaderboard" id="leaderboard" style="display: none;">
                    <h3>Classement</h3>
                    <div id="leaderboardContent"></div>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 30px;">
                    <button class="btn-primary" onclick="backToMenu()">Retour au menu</button>
                    <button class="btn-primary" onclick="restartQuiz()">Recommencer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Portal Cake Easter Egg (si tu veux mettre une image ici plus tard) -->
    <div class="portal-cake">
        <!-- <img src="ton-image.png" alt=""> -->
    </div>
    
    <footer class="footer">
        <p>"The cake is a lie"</p>
        <p>Subject: you | Test Protocol: [REDACTED]</p>
    </footer>

    <script>
        const modules = {
            python: {
                name: "Python",
                description: "Types, boucles, fonctions, fichiers",
                questions: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13]
            },
            git: {
                name: "Git",
                description: "Branches, commits, conflits, versioning",
                questions: [14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
            },
            recursivite: {
                name: "Récursivité",
                description: "Fonctions récursives et cas de base",
                questions: [24, 25]
            },
            debogage: {
                name: "Débogage",
                description: "Breakpoints, step, pile d'appels",
                questions: [26, 27, 28, 29]
            },
            memoire: {
                name: "Mémoire",
                description: "Schémas mémoire, pointeurs, références",
                questions: [30, 31, 32]
            },
            tests: {
                name: "Tests Unitaires",
                description: "FIRST, mocks, assertions",
                questions: [33, 34, 35, 36, 37, 38, 39, 40, 41, 59, 60, 61, 62]
            },
            poo: {
                name: "POO",
                description: "Classes, héritage, encapsulation, abstraction",
                questions: [42, 43, 44, 45, 46, 47, 48, 49, 50, 51]
            },
            documentation: {
                name: "Documentation",
                description: "JavaDoc, Sphinx, commentaires",
                questions: [52]
            },
            uml: {
                name: "UML",
                description: "Diagrammes de classes",
                questions: [53, 54]
            },
            unity: {
                name: "Unity",
                description: "MonoBehaviour, composants, GameObjects",
                questions: [55, 56, 57, 58]
            }
        };

        const portalVoices = [
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/critical-error.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/good-shot.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/hello-friend.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/hey-hey-hey.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/i-dont-blame-you.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/i-see-you.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/illegal-operation.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/is-anyone-there.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/noooooo.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/oh-dear.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/please-stop.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/sleep-mode-activated.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/thank-you.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/um-hello.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/what-are-you-doing.mp3',
            'https://raw.githubusercontent.com/DNSZLSK/cdaquiz/master/turretVocals/who-are-you.mp3'
        ];
        
        // Variable pour stocker le dernier son joué
        let lastPlayedIndex = -1;
        
        // Fonction pour jouer un vocal aléatoire (sans répétition immédiate)
        function playRandomPortalVoice() {
            let randomIndex;
            
            // Si on a plusieurs sons, éviter de rejouer le même
            if (portalVoices.length > 1) {
                do {
                    randomIndex = Math.floor(Math.random() * portalVoices.length);
                } while (randomIndex === lastPlayedIndex);
            } else {
                randomIndex = 0;
            }
            
            lastPlayedIndex = randomIndex;
            
            const audio = new Audio(portalVoices[randomIndex]);
            audio.volume = 0.3;
            audio.play().catch(err => console.log('Erreur lecture audio:', err));
        }
        
        // Ajouter l'événement au logo
        document.addEventListener('DOMContentLoaded', function() {
            const logo = document.getElementById('apertureLogo');
            if (logo) {
                logo.addEventListener('click', playRandomPortalVoice);
            }
        });
        
        const quizData = [
            { id: 1, module: "python", question: "Quelle est la différence entre le type int et le type float ?", options: ["int stocke des nombres entiers, float stocke des nombres décimaux", "int utilise 32 bits tandis que float utilise toujours 64 bits", "float peut représenter des entiers plus grands grâce à l'exposant", "int est immutable alors que float est mutable"], correct: [0], explanation: "int (integer) stocke des nombres entiers (ex: 5, -3, 100), tandis que float stocke des nombres à virgule flottante (ex: 3.14, -0.5, 2.0). La taille en bits dépend de l'architecture." },
            { id: 2, module: "python", question: "Comment s'appelle cette opération : nom = \"Sophie \" + \"Duchemin\"", options: ["Concaténation", "Interpolation de chaînes", "Agrégation", "Serialisation"], correct: [0], explanation: "La concaténation est l'opération qui consiste à assembler deux chaînes de caractères bout à bout avec l'opérateur +." },
            { id: 3, module: "python", question: "Comment ajouter un élément à la fin d'un tableau en Python ? En Java ?", options: ["Python: liste.append(element) / Java: liste.add(element)", "Python: liste.push(element) / Java: liste.append(element)", "Python: liste.insert(-1, element) / Java: liste.push(element)", "Python: liste.add(element) / Java: liste.addLast(element)"], correct: [0], explanation: "En Python, on utilise la méthode append() pour les listes. En Java, on utilise add() pour les ArrayList." },
            { id: 4, module: "python", question: "Comment concaténer deux tableaux en Python ? En Java ?", options: ["Python: liste1 + liste2 / Java: liste1.addAll(liste2)", "Python: liste1.extend(liste2) / Java: liste1.concat(liste2)", "Python: liste1.merge(liste2) / Java: liste1.append(liste2)", "Python: liste1.concat(liste2) / Java: liste1 + liste2"], correct: [0], explanation: "En Python, l'opérateur + concatène deux listes et crée une nouvelle liste. En Java, on utilise addAll() pour ajouter tous les éléments d'une liste à une autre." },
            { id: 5, module: "python", question: "Quelle est la différence entre if, elif et else ?", options: ["if teste une condition, elif teste une autre si la première est fausse, else s'exécute si toutes sont fausses", "if et elif s'exécutent en parallèle, else s'exécute toujours en dernier", "elif a une priorité plus élevée que if dans l'ordre d'évaluation", "if peut contenir plusieurs conditions, elif une seule, else aucune"], correct: [0], explanation: "if teste la première condition, elif (else if) teste des conditions alternatives en séquence, et else s'exécute si aucune condition n'est vraie." },
            { id: 6, module: "python", question: "Quelle est la différence entre une boucle for et une boucle while ?", options: ["for itère un nombre défini de fois, while continue tant qu'une condition est vraie", "for nécessite un itérateur, while utilise uniquement des indices numériques", "while est plus performante car elle ne crée pas d'itérateur temporaire", "for évalue la condition après chaque itération, while avant"], correct: [0], explanation: "for est utilisée quand on connaît le nombre d'itérations ou qu'on itère sur une séquence, while continue tant que sa condition est vraie." },
            { id: 7, module: "python", question: "Est-ce que les commentaires sont lus et exécutés par Python ?", options: ["Non, ils sont ignorés par l'interpréteur", "Oui, ils sont stockés en mémoire pour la documentation", "Oui, mais uniquement les commentaires docstring", "Non, sauf s'ils contiennent des directives spéciales"], correct: [0], explanation: "Les commentaires (# et docstrings) sont complètement ignorés lors de l'exécution. Les docstrings sont stockées comme attribut __doc__ mais ne sont pas exécutées." },
            { id: 8, module: "python", question: "Pourquoi est-il utile d'utiliser des fonctions dans un programme ?", options: ["Réutilisabilité du code et meilleure organisation", "Améliorer les performances en compilant le code en bytecode optimisé", "Réduire l'utilisation de la mémoire en partageant les variables", "Permettre l'exécution parallèle de plusieurs opérations"], correct: [0], explanation: "Les fonctions permettent de réutiliser du code, de mieux organiser le programme et de faciliter la maintenance en isolant la logique." },
            { id: 9, module: "python", question: "Que se passe-t-il si on définit une fonction, mais qu'on ne l'appelle jamais ?", options: ["Rien, la fonction existe mais son code n'est jamais exécuté", "Python génère un warning de fonction non utilisée", "La fonction est automatiquement optimisée et supprimée", "Le code de la fonction est quand même compilé et ralentit le programme"], correct: [0], explanation: "Définir une fonction ne l'exécute pas. Elle reste en mémoire mais son code ne s'exécute que lors d'un appel explicite." },
            { id: 10, module: "python", question: "Que représente un paramètre dans une fonction ?", options: ["Une variable qui reçoit une valeur lors de l'appel de la fonction", "Une constante définie au moment de la déclaration", "Un pointeur vers la variable passée en argument", "Une référence immuable à l'objet d'origine"], correct: [0], explanation: "Un paramètre est une variable définie dans la signature de la fonction qui recevra une valeur (argument) lors de l'appel." },
            { id: 11, module: "python", question: "À quoi sert le mot-clé return dans une fonction ?", options: ["Renvoyer une valeur au code qui a appelé la fonction", "Terminer l'exécution et libérer la mémoire allouée", "Créer un point de sauvegarde pour reprendre l'exécution plus tard", "Indiquer que la fonction a réussi son exécution"], correct: [0], explanation: "return permet à une fonction de renvoyer une valeur au code appelant et termine l'exécution de la fonction. Sans return explicite, la fonction renvoie None." },
            { id: 12, module: "python", question: "Dans quel cas utiliserais-tu le mode 'r' et dans quel cas utiliserais-tu le mode 'w' en ouvrant un fichier ?", options: ["'r' pour lire un fichier existant, 'w' pour écrire (écrase le contenu)", "'r' pour lire et écrire, 'w' uniquement pour écrire", "'r' crée le fichier s'il n'existe pas, 'w' génère une erreur", "'w' ajoute du contenu à la fin sans effacer"], correct: [0], explanation: "Mode 'r' (read) pour lire un fichier existant, 'w' (write) pour écrire en écrasant le contenu. Utilisez 'a' (append) pour ajouter sans effacer, 'r+' pour lire et écrire." },
            { id: 13, module: "python", question: "Que risque-t-on si on ferme un fichier en mode écriture sans l'opération close() ?", options: ["Perte de données ou fichier corrompu", "Fuite mémoire jusqu'au redémarrage du programme", "Le fichier reste verrouillé pour les autres processus", "Python génère une exception FileNotClosedError"], correct: [0], explanation: "Sans close(), les données en buffer peuvent ne pas être écrites (flush) sur le disque, causant une perte de données. Utilisez 'with' pour gérer automatiquement la fermeture." },
            { id: 14, module: "git", question: "À quoi sert une branche dans un projet versionné avec Git ?", options: ["Développer des fonctionnalités isolément sans affecter la branche principale", "Créer une copie complète du repository pour travailler hors ligne", "Compresser l'historique des commits pour économiser de l'espace", "Synchroniser automatiquement les modifications avec le serveur distant"], correct: [0], explanation: "Les branches permettent de travailler sur des fonctionnalités ou corrections en parallèle sans impacter le code principal (main/master)." },
            { id: 15, module: "git", question: "Que se passe-t-il lorsqu'on fusionne une branche avec la branche principale ?", options: ["Les modifications de la branche sont intégrées dans la branche principale", "La branche fusionnée est automatiquement supprimée", "Un nouveau commit de fusion est toujours créé", "L'historique de la branche est réécrit pour s'aligner sur main"], correct: [0], explanation: "La fusion (merge) intègre les changements d'une branche dans une autre. Un commit de fusion n'est créé que si nécessaire (pas en fast-forward)." },
            { id: 16, module: "git", question: "Quelle est la commande pour enregistrer des modifications dans l'historique local de Git ?", options: ["git commit", "git save", "git record", "git checkpoint"], correct: [0], explanation: "git commit enregistre les modifications dans l'historique local. Il faut d'abord faire git add pour mettre les fichiers en staging area." },
            { id: 17, module: "git", question: "Quelle commande permet de copier un dépôt distant sur ton ordinateur ?", options: ["git clone", "git pull", "git fetch", "git download"], correct: [0], explanation: "git clone crée une copie locale complète d'un dépôt distant avec tout son historique. git pull met à jour un dépôt existant, git fetch récupère sans fusionner." },
            { id: 18, module: "git", question: "Quelle commande permet de changer de branche ?", options: ["git checkout ou git switch", "git branch -m", "git change", "git move"], correct: [0], explanation: "git checkout (ancien) ou git switch (moderne) permettent de changer de branche. git branch liste ou crée des branches sans changer." },
            { id: 19, module: "git", question: "Quelle est la principale différence entre Git et GitLab ?", options: ["Git est un système de contrôle de version, GitLab est une plateforme web pour héberger des dépôts Git", "Git est open source, GitLab est propriétaire", "GitLab inclut des fonctionnalités que Git n'a pas comme les branches", "Git fonctionne en local, GitLab nécessite une connexion internet"], correct: [0], explanation: "Git est l'outil de versioning en ligne de commande, GitLab est une plateforme web (comme GitHub) qui héberge des projets Git avec CI/CD, issues, merge requests, etc." },
            { id: 20, module: "git", question: "Cite un autre outil de gestion de version que Git.", options: ["SVN (Subversion) ou Mercurial", "Docker", "NPM", "Webpack"], correct: [0], explanation: "SVN (Subversion), Mercurial, Perforce sont d'autres systèmes de contrôle de version. Docker est pour les conteneurs, NPM pour les packages." },
            { id: 21, module: "git", question: "Quelle est la différence entre un dépôt local et un dépôt distant ?", options: ["Local est sur ton ordinateur, distant est sur un serveur (GitHub, GitLab...)", "Local contient seulement la branche courante, distant contient toutes les branches", "Distant est en lecture seule, local permet les modifications", "Local est temporaire, distant est permanent"], correct: [0], explanation: "Le dépôt local est sur votre machine avec l'historique complet, le dépôt distant (remote) est hébergé sur un serveur pour partager et collaborer." },
            { id: 22, module: "git", question: "Pourquoi est-il important de push régulièrement ses modifications vers le dépôt distant ?", options: ["Sauvegarde, partage avec l'équipe, et collaboration", "Libérer de l'espace disque sur la machine locale", "Activer les hooks de validation côté serveur", "Synchroniser automatiquement avec toutes les branches"], correct: [0], explanation: "Push régulièrement permet de sauvegarder son travail sur le serveur, de le partager avec l'équipe et de faciliter la collaboration en temps réel." },
            { id: 23, module: "git", question: "Qu'est-ce qu'un conflit de fusion (merge conflict) dans Git ?", options: ["Quand deux modifications incompatibles affectent les mêmes lignes de code", "Quand deux branches ont des noms identiques", "Quand le serveur distant refuse la fusion pour raisons de sécurité", "Quand l'historique des commits est trop divergent"], correct: [0], explanation: "Un conflit survient quand Git ne peut pas fusionner automatiquement car les mêmes lignes ont été modifiées différemment dans deux branches." },
            { id: 24, module: "recursivite", question: "Qu'est-ce qui distingue une fonction récursive d'une fonction classique ?", options: ["Une fonction récursive s'appelle elle-même", "Une fonction récursive utilise moins de mémoire", "Une fonction récursive s'exécute en temps constant", "Une fonction récursive ne peut pas avoir d'effets de bord"], correct: [0], explanation: "Une fonction récursive est une fonction qui s'appelle elle-même pour résoudre un problème en le décomposant en sous-problèmes plus simples." },
            { id: 25, module: "recursivite", question: "Pourquoi est-il important de définir un cas de base dans une fonction récursive ?", options: ["Pour arrêter la récursion et éviter une boucle infinie", "Pour optimiser les performances en cache", "Pour permettre la compilation tail-call", "Pour définir la valeur de retour par défaut"], correct: [0], explanation: "Le cas de base (condition d'arrêt) est essentiel pour arrêter la récursion. Sans lui, la fonction s'appellerait indéfiniment jusqu'au stack overflow." },
            { id: 26, module: "debogage", question: "À quoi sert un point d'arrêt dans un débogueur ?", options: ["Suspendre l'exécution du programme à un endroit précis pour inspecter l'état", "Marquer une erreur potentielle pour la corriger plus tard", "Créer un checkpoint pour sauvegarder l'état du programme", "Mesurer les performances d'une section de code"], correct: [0], explanation: "Un breakpoint (point d'arrêt) suspend l'exécution pour permettre d'inspecter les variables, la pile d'appels, et comprendre le comportement du code à cet instant." },
            { id: 27, module: "debogage", question: "Où est-il judicieux de placer un point d'arrêt lorsqu'on cherche une erreur logique dans une boucle ?", options: ["Juste avant ou au début de la boucle", "Uniquement sur la ligne qui cause l'erreur", "À chaque instruction de la boucle", "Après la dernière itération seulement"], correct: [0], explanation: "Placer un breakpoint avant ou au début de la boucle permet d'inspecter les valeurs initiales et à chaque itération pour comprendre où la logique échoue." },
            { id: 28, module: "debogage", question: "Quelle est la différence entre les actions 'step over' et 'step into' dans un débogueur ?", options: ["Step over exécute la fonction entière, step into entre dans la fonction", "Step over est plus rapide car il ignore les fonctions", "Step into crée un nouveau point d'arrêt temporaire", "Step over saute les boucles, step into les exécute"], correct: [0], explanation: "Step over (F10) exécute la ligne courante sans entrer dans les fonctions appelées. Step into (F11) entre dans le détail des fonctions pour les déboguer." },
            { id: 29, module: "debogage", question: "Pourquoi est-il utile de consulter la pile d'appels lorsqu'un programme plante avec une erreur ?", options: ["Elle montre la séquence d'appels de fonctions qui a mené à l'erreur", "Elle permet de restaurer le programme à un état stable", "Elle identifie automatiquement la ligne de code fautive", "Elle libère la mémoire allouée par les fonctions"], correct: [0], explanation: "La stack trace (pile d'appels) montre le chemin d'exécution complet qui a conduit à l'erreur, permettant de remonter à la source du problème." },
            { id: 30, module: "memoire", question: "Que représente un schéma mémoire d'un programme ?", options: ["La visualisation de comment les variables sont stockées en mémoire", "Le diagramme d'architecture du système", "Le graphe de dépendances entre les modules", "La consommation RAM en temps réel"], correct: [0], explanation: "Un schéma mémoire représente l'organisation des variables, objets et structures de données en mémoire RAM pendant l'exécution du programme." },
            { id: 31, module: "memoire", question: "Quelle est la différence entre la valeur d'une variable et l'adresse d'une variable ?", options: ["La valeur est le contenu stocké, l'adresse est l'emplacement en mémoire", "L'adresse est calculée à partir de la valeur par une fonction de hachage", "La valeur peut changer, l'adresse est toujours constante", "L'adresse est toujours un nombre hexadécimal, la valeur un décimal"], correct: [0], explanation: "La valeur est le contenu de la variable, l'adresse mémoire est l'emplacement (pointeur) où cette valeur est stockée dans la RAM." },
            { id: 32, module: "memoire", question: "Quel type de passage est utilisé lorsque tu modifies une liste dans une fonction en Python ?", options: ["Passage par référence (la liste originale est modifiée)", "Passage par valeur avec copie implicite", "Passage par pointeur avec déréférencement automatique", "Passage par copie superficielle (shallow copy)"], correct: [0], explanation: "Python utilise le passage par référence pour les objets mutables (listes, dicts). Modifier la liste dans la fonction modifie l'original car on manipule la même référence." },
            { id: 33, module: "tests", question: "À quel moment du développement est-il recommandé d'écrire les tests unitaires ?", options: ["Avant ou pendant le développement (TDD)", "Après la phase de déploiement en production", "Uniquement lors de la phase de maintenance", "Seulement si le code est complexe"], correct: [0], explanation: "Les tests peuvent être écrits avant (TDD - Test Driven Development) ou pendant le développement pour valider le code au fur et à mesure et garantir sa qualité." },
            { id: 34, module: "tests", question: "Quelle différence fais-tu entre assertEquals et assertTrue ?", options: ["assertEquals compare deux valeurs, assertTrue vérifie qu'une condition est vraie", "assertEquals est plus strict car il vérifie le type", "assertTrue est déprécié en faveur de assertEquals", "assertEquals accepte une marge d'erreur pour les floats"], correct: [0], explanation: "assertEquals(expected, actual) vérifie l'égalité exacte entre deux valeurs. assertTrue(condition) vérifie qu'une expression booléenne est vraie." },
            { id: 35, module: "tests", question: "Pourquoi est-il important d'avoir un jeu de données varié pour les tests unitaires ?", options: ["Pour tester tous les cas (normaux, limites, extrêmes, erreurs)", "Pour augmenter la couverture de code à 100%", "Pour simuler des conditions de production", "Pour valider les performances sous charge"], correct: [0], explanation: "Un jeu de données varié permet de tester les cas nominaux, les valeurs limites (edge cases), les cas d'erreur et les situations extrêmes pour garantir la robustesse." },
            { id: 36, module: "tests", question: "Donne un exemple de situation où un jeu de données mal choisi peut faire croire à tort que le code est correct.", options: ["Tester une division uniquement avec des nombres positifs non nuls", "Utiliser des données aléatoires qui couvrent tous les cas", "Tester avec un seul jeu de données mais l'exécuter plusieurs fois", "Ne pas mocker les dépendances externes"], correct: [0], explanation: "Si on teste diviser(10, 2) mais jamais diviser(10, 0), on rate le bug de division par zéro. Il faut tester les cas d'erreur, pas seulement le happy path." },
            { id: 37, module: "tests", question: "Que signifie l'acronyme FIRST dans le contexte des tests unitaires ?", options: ["Fast, Independent, Repeatable, Self-validating, Timely", "Function, Input, Result, State, Test", "Fast, Isolated, Reliable, Simple, Thorough", "Find, Inspect, Run, Succeed, Terminate"], correct: [0], explanation: "FIRST : Fast (rapide), Independent (indépendant), Repeatable (répétable), Self-validating (auto-validant), Timely (écrit au bon moment, avant ou pendant le développement)." },
            { id: 38, module: "tests", question: "Pourquoi est-ce important que les tests soient répétables et indépendants ?", options: ["Pour obtenir les mêmes résultats à chaque exécution et éviter les dépendances entre tests", "Pour permettre l'exécution parallèle sur plusieurs threads", "Pour réduire le temps d'exécution total de la suite de tests", "Pour faciliter le débogage en isolant les erreurs"], correct: [0], explanation: "Répétables : mêmes résultats à chaque exécution (pas de dépendance à l'heure, au hasard). Indépendants : un test ne doit pas dépendre du résultat d'un autre test." },
            { id: 39, module: "tests", question: "Quel serait un signe qu'un test ne respecte pas le principe Fast ?", options: ["Le test prend plusieurs secondes ou minutes à s'exécuter", "Le test utilise plusieurs assertions dans le même test", "Le test nécessite une configuration complexe", "Le test génère des fichiers temporaires"], correct: [0], explanation: "Un test lent (plusieurs secondes/minutes) viole le principe Fast. Les tests doivent être rapides (millisecondes) pour être exécutés fréquemment sans ralentir le développement." },
            { id: 40, module: "tests", question: "À quoi sert un mock dans un test unitaire ?", options: ["Simuler le comportement d'une dépendance externe pour isoler le code testé", "Créer des données de test aléatoires", "Accélérer l'exécution en court-circuitant le code", "Enregistrer les appels de méthodes pour l'analyse"], correct: [0], explanation: "Un mock simule une dépendance (BD, API, service) pour tester le code en isolation sans dépendre de systèmes externes lents, coûteux ou instables." },
            { id: 41, module: "tests", question: "Dans quel cas utiliserais-tu un mock plutôt qu'une méthode réelle dans un test ?", options: ["Quand la méthode dépend d'un service externe (BD, API, fichier...)", "Quand la méthode est trop complexe à tester", "Quand on veut améliorer la couverture de code", "Quand la méthode retourne des valeurs aléatoires"], correct: [0], explanation: "On utilise un mock quand la dépendance réelle est lente, coûteuse, instable, ou externe (BD, API, réseau, système de fichiers, etc.)." },
            { id: 42, module: "poo", question: "Quelle est la différence entre une classe et une instance de classe ?", options: ["La classe est le modèle/blueprint, l'instance est un objet créé à partir de ce modèle", "La classe est abstraite, l'instance est concrète", "Une instance peut hériter de plusieurs classes", "La classe est compilée, l'instance est interprétée"], correct: [0], explanation: "La classe définit la structure (attributs et méthodes), l'instance est un objet concret créé à partir de cette classe avec ses propres valeurs d'attributs." },
            { id: 43, module: "poo", question: "Que représente un attribut dans une classe ? Et une méthode ?", options: ["Attribut = variable/propriété de l'objet, Méthode = fonction de l'objet", "Attribut = type de l'objet, Méthode = action sur le type", "Attribut = valeur constante, Méthode = valeur calculée", "Attribut = donnée statique, Méthode = donnée dynamique"], correct: [0], explanation: "Un attribut est une variable qui stocke l'état de l'objet (données). Une méthode est une fonction qui définit son comportement (actions)." },
            { id: 44, module: "poo", question: "À quoi sert le mot-clé 'self' (Python) ou 'this' (Java) dans une méthode de classe ?", options: ["Référencer l'instance courante de la classe", "Déclarer une variable locale à la méthode", "Indiquer que la méthode est publique", "Créer une copie de l'objet"], correct: [0], explanation: "self/this fait référence à l'instance courante de la classe, permettant d'accéder à ses attributs et méthodes depuis l'intérieur de la classe." },
            { id: 45, module: "poo", question: "Quel est le rôle d'un constructeur dans une classe ?", options: ["Initialiser les attributs d'un nouvel objet lors de sa création", "Valider que l'objet respecte les contraintes métier", "Allouer la mémoire nécessaire pour l'objet", "Enregistrer l'objet dans un registre global"], correct: [0], explanation: "Le constructeur (__init__ en Python, même nom que la classe en Java) initialise l'état de l'objet lors de sa création en définissant les valeurs initiales des attributs." },
            { id: 46, module: "poo", question: "Que se passe-t-il si on ne définit pas de constructeur dans une classe ?", options: ["Un constructeur par défaut est automatiquement créé", "La classe ne peut pas être instanciée", "Les attributs sont initialisés à null", "Un warning de compilation est généré"], correct: [0], explanation: "Si aucun constructeur n'est défini explicitement, un constructeur par défaut (vide) est automatiquement fourni par le langage." },
            { id: 47, module: "poo", question: "Quels sont les quatre grands principes de la programmation orientée objet ?", options: ["Encapsulation, Héritage, Polymorphisme, Abstraction", "Modularité, Réutilisabilité, Extensibilité, Maintenabilité", "Couplage faible, Cohésion forte, Séparation des responsabilités, Injection de dépendances", "Composition, Agrégation, Association, Dépendance"], correct: [0], explanation: "Les 4 piliers de la POO sont : Encapsulation (masquer les détails), Héritage (réutiliser du code), Polymorphisme (plusieurs formes), Abstraction (simplifier)." },
            { id: 48, module: "poo", question: "Explique le principe d'Encapsulation.", options: ["Cacher les détails internes et exposer uniquement ce qui est nécessaire", "Regrouper les données et méthodes dans une même classe", "Protéger les données avec des modificateurs d'accès", "Isoler chaque objet dans son propre espace mémoire"], correct: [0], explanation: "L'encapsulation consiste à masquer les données internes (attributs privés) et à contrôler l'accès via des méthodes publiques (getters/setters), protégeant l'intégrité des données." },
            { id: 49, module: "poo", question: "Comment l'abstraction améliore-t-elle la lisibilité et la maintenance du code ?", options: ["En cachant la complexité et en exposant uniquement l'interface simple", "En réduisant le nombre de lignes de code", "En utilisant des noms de variables plus courts", "En évitant les commentaires redondants"], correct: [0], explanation: "L'abstraction permet de se concentrer sur 'quoi' fait le code plutôt que 'comment', simplifiant la compréhension et l'utilisation. On cache les détails d'implémentation complexes." },
            { id: 50, module: "poo", question: "Quelle est la différence entre association et composition entre deux classes ?", options: ["Association = relation faible, Composition = relation forte où l'objet enfant n'existe pas sans le parent", "Association utilise l'héritage, Composition utilise les interfaces", "Composition permet le polymorphisme, Association non", "Association est statique, Composition est dynamique"], correct: [0], explanation: "Association : les objets existent indépendamment (Professeur-Étudiant). Composition : l'objet enfant ne peut exister sans le parent (Voiture-Moteur), cycle de vie lié." },
            { id: 51, module: "poo", question: "Dans quel cas utiliserais-tu une composition plutôt qu'une simple association ?", options: ["Quand un objet fait partie intégrante d'un autre et ne peut exister sans lui", "Quand on veut éviter l'héritage multiple", "Quand les objets doivent communiquer fréquemment", "Quand on veut réduire le couplage entre classes"], correct: [0], explanation: "Utilisez la composition quand il y a une relation 'fait partie de' forte avec cycle de vie dépendant (ex: Maison-Pièce, Livre-Page). Les pièces n'existent pas sans la maison." },
            { id: 52, module: "documentation", question: "Quelle est la différence entre un commentaire simple et une documentation générée automatiquement avec JavaDoc/Sphinx ?", options: ["JavaDoc/Sphinx génèrent une documentation HTML formatée à partir de commentaires structurés", "JavaDoc/Sphinx sont obligatoires pour compiler le code", "Les commentaires simples sont visibles dans l'IDE, JavaDoc/Sphinx non", "JavaDoc/Sphinx ajoutent des métadonnées au bytecode"], correct: [0], explanation: "JavaDoc/Sphinx utilisent des commentaires spéciaux (/** */ ou ''') avec des tags (@param, @return) pour générer automatiquement une documentation web professionnelle et navigable." },
            { id: 53, module: "uml", question: "Que signifie un losange noir dans un diagramme UML ?", options: ["Relation de composition (forte)", "Héritage multiple", "Agrégation faible", "Interface obligatoire"], correct: [0], explanation: "Le losange noir (♦) représente une composition, une relation forte où l'objet composant ne peut exister sans le composé. Cycle de vie dépendant." },
            { id: 54, module: "uml", question: "Comment peut-on représenter l'héritage entre deux classes sur un diagramme de classe ?", options: ["Une flèche avec un triangle vide pointant vers la classe parente", "Une ligne pleine avec un losange", "Une flèche en pointillés", "Deux lignes parallèles"], correct: [0], explanation: "L'héritage se représente par une flèche avec un triangle vide (△) pointant de la classe enfant vers la classe parente. Ligne continue pour les classes, pointillés pour les interfaces." },
            { id: 55, module: "unity", question: "À quoi correspond une classe qui hérite de MonoBehaviour dans Unity ?", options: ["Un script qui peut être attaché à un GameObject", "Un composant natif du moteur Unity", "Un système de gestion des entrées utilisateur", "Une classe abstraite pour les animations"], correct: [0], explanation: "MonoBehaviour est la classe de base pour tous les scripts Unity attachables aux GameObjects, donnant accès au cycle de vie Unity (Start, Update, etc.) et aux composants." },
            { id: 56, module: "unity", question: "Quelle est la différence entre la méthode Start() et la méthode Update() dans une classe Unity ?", options: ["Start() s'exécute une fois au démarrage, Update() s'exécute à chaque frame", "Start() est appelée après Update()", "Update() est appelée seulement si l'objet est actif", "Start() peut être appelée plusieurs fois"], correct: [0], explanation: "Start() est appelée une fois lors de l'initialisation du script (avant la première frame). Update() est appelée à chaque frame (environ 60 fois par seconde selon le framerate)." },
            { id: 57, module: "unity", question: "Pourquoi utilise-t-on souvent le mot-clé public devant certaines variables dans Unity ? Quels avantages et risques cela entraîne-t-il ?", options: ["Avantage : visible dans l'Inspector. Risque : moins d'encapsulation et modification accidentelle", "Avantage : performances accrues. Risque : consommation mémoire", "C'est obligatoire pour la sérialisation", "Aucun risque, c'est la meilleure pratique"], correct: [0], explanation: "Les variables public sont éditables dans l'Inspector Unity (pratique pour le level design) mais exposent les données. Préférez [SerializeField] private pour garder l'encapsulation tout en ayant l'édition visuelle." },
            { id: 58, module: "unity", question: "Comment utiliser la composition pour enrichir le comportement d'un GameObject dans Unity ?", options: ["Attacher plusieurs scripts (composants) au même GameObject", "Créer une hiérarchie d'héritage complexe", "Utiliser des interfaces pour partager le code", "Regrouper toute la logique dans un seul MonoBehaviour"], correct: [0], explanation: "Unity favorise la composition (Entity Component System) : ajoutez plusieurs composants spécialisés (scripts) au GameObject plutôt qu'un seul script monolithique. Chaque composant gère une responsabilité." },
            { id: 59, module: "tests", question: "Que signifie le pattern AAA dans l'organisation d'un test unitaire ?", options: ["Arrange (préparer), Act (agir), Assert (vérifier)", "Allocate, Apply, Analyze", "Add, Activate, Approve", "Assign, Automate, Audit"], correct: [0], explanation: "Le pattern AAA structure les tests en 3 phases : Arrange (préparer le contexte et les données), Act (exécuter l'action testée), Assert (vérifier le résultat). Cela rend les tests lisibles et maintenables." },
            { id: 59, module: "tests", question: "Que signifie le pattern AAA dans l'organisation d'un test unitaire ?", options: ["Arrange (préparer), Act (agir), Assert (vérifier)", "Allocate, Apply, Analyze", "Add, Activate, Approve", "Assign, Automate, Audit"], correct: [0], explanation: "Le pattern AAA structure les tests en 3 phases : Arrange (préparer le contexte et les données), Act (exécuter l'action testée), Assert (vérifier le résultat). Cela rend les tests lisibles et maintenables." },
            { id: 60, module: "tests", question: "Quelle est la différence entre any() et eq() dans Mockito ?", options: ["any() accepte n'importe quelle valeur du type, eq() vérifie l'égalité stricte", "any() est plus performant car il ne compare pas les valeurs", "eq() est déprécié en faveur de any()", "any() fonctionne uniquement avec les objets, eq() avec les primitifs"], correct: [0], explanation: "any(Type.class) accepte n'importe quelle valeur de ce type. eq(valeur) vérifie que le paramètre est exactement égal à la valeur donnée (via .equals()). Les matchers permettent de vérifier les appels de méthodes mockées de façon flexible." },
            { id: 61, module: "tests", question: "Quelle règle faut-il respecter quand on utilise des matchers Mockito (any(), eq(), etc.) ?", options: ["Si on utilise un matcher, tous les paramètres doivent être des matchers", "On ne peut utiliser qu'un seul matcher par méthode verify", "Les matchers doivent toujours être combinés avec des valeurs directes", "Les matchers sont interdits dans les assertions"], correct: [0], explanation: "Règle importante : si vous utilisez UN matcher, TOUS les paramètres doivent être des matchers. Incorrect : verify(mock).method(any(), valeur). Correct : verify(mock).method(any(), eq(valeur)). Sinon Mockito génère une erreur." },
            { id: 62, module: "tests", question: "Quelle est la différence entre verify() et when() dans Mockito ?", options: ["verify() vérifie qu'une méthode a été appelée, when() configure le comportement d'un mock", "verify() est utilisé dans Arrange, when() dans Assert", "when() vérifie les appels, verify() configure les mocks", "verify() fonctionne avec les vrais objets, when() avec les mocks"], correct: [0], explanation: "when(mock.method()).thenReturn(value) configure le comportement du mock (phase Arrange). verify(mock).method() vérifie que la méthode a bien été appelée (phase Assert). Ce sont deux opérations complémentaires mais différentes." }
        ];

        let currentMode = 'normal';
        let selectedModule = null;
        let currentQuestions = [];
        let currentQuestion = 0;
        let score = 0;
        let moduleScores = {};

        function initApp() {
            renderModuleGrid();
        }

        function renderModuleGrid() {
            const grid = document.getElementById('moduleGrid');
            grid.innerHTML = '';

            // Option "Tous les modules"
            const allCard = document.createElement('div');
            allCard.className = 'module-card all';
            allCard.onclick = () => startQuiz('all');
            allCard.innerHTML = `
                <h3>Tous les modules</h3>
                <p>Évaluation complète</p>
                <p class="question-count">${quizData.length} questions</p>
            `;
            grid.appendChild(allCard);

            // Cartes pour chaque module
            for (const [key, module] of Object.entries(modules)) {
                const card = document.createElement('div');
                card.className = `module-card ${key}`;
                card.onclick = () => startQuiz(key);
                card.innerHTML = `
                    <h3>${module.name}</h3>
                    <p>${module.description}</p>
                    <p class="question-count">${module.questions.length} questions</p>
                `;
                grid.appendChild(card);
            }
        }

        function startQuiz(moduleKey) {
            selectedModule = moduleKey;
            
            // Filtrer les questions
            if (moduleKey === 'all') {
                currentQuestions = [...quizData];
            } else {
                const questionIds = modules[moduleKey].questions;
                currentQuestions = quizData.filter(q => questionIds.includes(q.id));
            }

            // Mélanger les questions
            currentQuestions = shuffleArray(currentQuestions);

            // Mélanger les réponses pour chaque question
            currentQuestions.forEach(q => {
                const shuffled = shuffleOptions(q.options, q.correct);
                q.shuffledOptions = shuffled.options;
                q.shuffledCorrect = shuffled.correct;
            });

            // Reset
            currentQuestion = 0;
            score = 0;
            moduleScores = {};

            // Afficher le quiz
            document.getElementById('menu').classList.remove('active');
            renderQuestion();
            updateProgress();
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function shuffleOptions(options, correctIndices) {
            const combined = options.map((opt, idx) => ({
                text: opt,
                wasCorrect: correctIndices.includes(idx)
            }));

            // Mélanger
            for (let i = combined.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [combined[i], combined[j]] = [combined[j], combined[i]];
            }

            // Reconstruire
            const newOptions = combined.map(c => c.text);
            const newCorrect = combined.map((c, idx) => c.wasCorrect ? idx : -1).filter(i => i >= 0);

            return { options: newOptions, correct: newCorrect };
        }

        function renderQuestion() {
            const container = document.getElementById('quizContent');
            const question = currentQuestions[currentQuestion];
            
            container.innerHTML = `
                <div class="question-container active">
                    <div class="question-header">
                        <span class="question-number">Question ${currentQuestion + 1}/${currentQuestions.length}</span>
                        <span class="module-tag">${modules[question.module]?.name || question.module}</span>
                    </div>
                    
                    <div class="question-text">${question.question}</div>
                    
                    <div class="options" id="options">
                        ${question.shuffledOptions.map((option, index) => `
                            <label class="option" data-index="${index}">
                                <input type="checkbox" name="answer" value="${index}">
                                <span>${option}</span>
                            </label>
                        `).join('')}
                    </div>
                    
                    <div class="explanation" id="explanation">
                        <h4>Explication</h4>
                        <p>${question.explanation}</p>
                    </div>
                    
                    <div class="buttons">
                        <div style="display: flex; gap: 12px;">
                            <button onclick="backToMenu()">Menu</button>
                            <button onclick="previousQuestion()" ${currentQuestion === 0 ? 'disabled' : ''}>
                                Précédent
                            </button>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn-primary" id="validateBtn" onclick="validateAnswer()">
                                Valider
                            </button>
                            <button class="btn-primary" id="nextBtn" onclick="nextQuestion()" style="display: none;">
                                ${currentQuestion === currentQuestions.length - 1 ? 'Voir les résultats' : 'Suivant'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function validateAnswer() {
            const question = currentQuestions[currentQuestion];
            const checkboxes = document.querySelectorAll('input[name="answer"]');
            const selectedAnswers = [];
            
            checkboxes.forEach((checkbox, index) => {
                if (checkbox.checked) {
                    selectedAnswers.push(index);
                }
            });

            if (selectedAnswers.length === 0) {
                // Message style Aperture Science
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: #fff;
                    border: 1px solid #d1d5da;
                    padding: 30px 40px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    z-index: 1000;
                    text-align: center;
                    max-width: 400px;
                `;
                errorDiv.innerHTML = `
                    <div style="font-size: 1.2em; font-weight: 600; color: #24292e; margin-bottom: 15px;">
                        Erreur de protocole
                    </div>
                    <div style="color: #586069; margin-bottom: 20px;">
                        Le Centre d'Enrichissement vous rappelle de sélectionner au moins une réponse avant de continuer.
                    </div>
                    <button onclick="this.parentElement.remove()" class="btn-primary" style="width: 100%;">
                        Compris
                    </button>
                `;
                document.body.appendChild(errorDiv);
                return;
            }
            
            // Disable all options
            document.querySelectorAll('.option').forEach(option => {
                option.classList.add('disabled');
            });

            // Check answers
            let isCorrect = true;
            checkboxes.forEach((checkbox, index) => {
                const option = checkbox.closest('.option');
                if (question.shuffledCorrect.includes(index)) {
                    option.classList.add('correct');
                    if (!checkbox.checked) {
                        isCorrect = false;
                    }
                } else if (checkbox.checked) {
                    option.classList.add('incorrect');
                    isCorrect = false;
                }
            });

            if (isCorrect) {
                score++;
                if (!moduleScores[question.module]) {
                    moduleScores[question.module] = { correct: 0, total: 0 };
                }
                moduleScores[question.module].correct++;
            }

            if (!moduleScores[question.module]) {
                moduleScores[question.module] = { correct: 0, total: 0 };
            }
            moduleScores[question.module].total++;

            // Show explanation and next button
            document.getElementById('explanation').classList.add('show');
            document.getElementById('validateBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';
        }

        function nextQuestion() {
            if (currentQuestion < currentQuestions.length - 1) {
                currentQuestion++;
                renderQuestion();
                updateProgress();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
                updateProgress();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / currentQuestions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function showResults() {
            document.getElementById('quizContent').style.display = 'none';
            const resultsDiv = document.getElementById('results');
            resultsDiv.classList.add('show');
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('totalQuestions').textContent = currentQuestions.length;

            // Message GLaDOS en français selon le score
            const percentage = (score / currentQuestions.length) * 100;
            let glaDOSMessage = '';
            
            if (score === 0) {
                glaDOSMessage = "Nous avons dû modifier vos résultats. Vous êtes un cas particulier.";
            } else if (percentage === 100) {
                glaDOSMessage = "Excellent. Vous êtes un triomphe.";
            } else if (percentage >= 75) {
                glaDOSMessage = "Performance acceptable. Le gâteau et les conseils en cas de chagrin seront disponibles à la fin du test.";
            } else if (percentage >= 50) {
                glaDOSMessage = "Le Centre d'Enrichissement vous rappelle que l'échec n'est que le succès arrondi à l'inférieur.";
            } else {
                glaDOSMessage = "Le test est maintenant terminé. Toutes les technologies Aperture restent opérationnelles.";
            }
            
            // Ajouter le message GLaDOS après le score
            const scoreDisplay = document.querySelector('.score-display');
            const glaDOSDiv = document.createElement('div');
            glaDOSDiv.style.cssText = 'text-align: center; font-style: italic; color: #586069; margin-top: 20px; font-size: 0.9em; padding: 0 20px;';
            glaDOSDiv.textContent = `"${glaDOSMessage}"`;
            scoreDisplay.appendChild(glaDOSDiv);

            // Stats par module
            const statsDiv = document.getElementById('moduleStats');
            statsDiv.innerHTML = '<h3>Détails par module</h3>';
            
            for (const [moduleKey, stats] of Object.entries(moduleScores)) {
                const percentage = (stats.correct / stats.total) * 100;
                let scoreClass = 'bad';
                if (percentage >= 75) scoreClass = 'good';
                else if (percentage >= 50) scoreClass = 'medium';

                const item = document.createElement('div');
                item.className = 'stat-item';
                item.innerHTML = `
                    <span class="module-name">${modules[moduleKey]?.name || moduleKey}</span>
                    <span class="module-score ${scoreClass}">${stats.correct}/${stats.total} (${percentage.toFixed(0)}%)</span>
                `;
                statsDiv.appendChild(item);
            }
        }

        function restartQuiz() {
            document.getElementById('results').classList.remove('show');
            document.getElementById('quizContent').style.display = 'block';
            startQuiz(selectedModule);
        }

        function backToMenu() {
            document.getElementById('results').classList.remove('show');
            document.getElementById('quizContent').style.display = 'block';
            document.getElementById('quizContent').innerHTML = '';
            document.getElementById('menu').classList.add('active');
            document.getElementById('progressBar').style.width = '0%';
        }

        window.onload = initApp;
    </script>
</body>
</html>